<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª ØµÙØ­Ø§Øª</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .section { background: white; padding: 20px; margin: 20px 0; border-radius: 10px; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ØªØ³Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ ØµÙØ­Ø§Øª</h1>

    <div class="section">
        <h2>ğŸ“Š ØªØ³Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ latest_report.json</h2>
        <button onclick="testReportLoading()">ğŸ”„ ØªØ³Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</button>
        <div id="reportTest"></div>
    </div>

    <div class="section">
        <h2>ğŸ“‹ ØªØ³Øª index.html</h2>
        <button onclick="testIndex()">ğŸ”„ ØªØ³Øª Index</button>
        <div id="indexTest"></div>
    </div>

    <div class="section">
        <h2>ğŸ“Š ØªØ³Øª dashboard.html</h2>
        <button onclick="testDashboard()">ğŸ”„ ØªØ³Øª Dashboard</button>
        <div id="dashboardTest"></div>
    </div>

    <div class="section">
        <h2>ğŸ”„ ØªØ³Øª Auto-Refresh</h2>
        <p>Auto-refresh ÙØ¹Ø§Ù„ Ø§Ø³Øª Ùˆ Ù‡Ø± 5 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
        <p>Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ: <span id="lastLoad">-</span></p>
        <p>ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ: <span id="loadCount">0</span></p>
    </div>

    <script>
        let loadCounter = 0;

        async function testReportLoading() {
            const output = document.getElementById('reportTest');
            output.innerHTML = '<p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>';
            
            try {
                const response = await fetch('subscriptions/latest_report.json');
                const report = await response.json();
                
                output.innerHTML = `
                    <p class="success">âœ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÙˆÙÙ‚!</p>
                    <pre>${JSON.stringify(report, null, 2)}</pre>
                    <h3>Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø®ØªØ§Ø±:</h3>
                    <p>âœ… timestamp: ${report.timestamp || 'âŒ Ù†Ø¯Ø§Ø±Ø¯'}</p>
                    <p>âœ… working_configs: ${report.working_configs || 'âŒ Ù†Ø¯Ø§Ø±Ø¯'}</p>
                    <p>âœ… protocols: ${Object.keys(report.protocols || {}).length} Ù¾Ø±ÙˆØªÚ©Ù„</p>
                `;
            } catch (error) {
                output.innerHTML = `<p class="error">âŒ Ø®Ø·Ø§: ${error.message}</p>`;
            }
        }

        async function testIndex() {
            const output = document.getElementById('indexTest');
            output.innerHTML = '<p>Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª...</p>';
            
            try {
                const response = await fetch('subscriptions/latest_report.json');
                const report = await response.json();
                
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø¯ index.html
                const totalConfigs = report.working_configs || 0;
                const lastUpdate = report.timestamp || 'Ù†Ø§Ù…Ø´Ø®Øµ';
                
                let protocolsHTML = '<h4>Ù¾Ø±ÙˆØªÚ©Ù„â€ŒÙ‡Ø§:</h4>';
                if (report.protocols) {
                    Object.entries(report.protocols).forEach(([protocol, data]) => {
                        protocolsHTML += `<p>- ${protocol}: ${data.count} (${data.avg_latency})</p>`;
                    });
                }
                
                output.innerHTML = `
                    <p class="success">âœ… ØªØ³Øª Ù…ÙˆÙÙ‚!</p>
                    <h4>Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯Ù‡:</h4>
                    <p>ğŸ“Š Ú©Ù„ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§: ${totalConfigs.toLocaleString('fa-IR')}</p>
                    <p>ğŸ• Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ${lastUpdate}</p>
                    ${protocolsHTML}
                `;
            } catch (error) {
                output.innerHTML = `<p class="error">âŒ Ø®Ø·Ø§: ${error.message}</p>`;
            }
        }

        async function testDashboard() {
            const output = document.getElementById('dashboardTest');
            output.innerHTML = '<p>Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª...</p>';
            
            try {
                const response = await fetch('subscriptions/latest_report.json');
                const report = await response.json();
                
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø¯ dashboard.html
                const totalHealthy = report.working_configs || 0;
                const totalFailed = report.failed_configs || 0;
                
                let successRate = 0;
                if (typeof report.success_rate === 'string') {
                    successRate = parseFloat(report.success_rate.replace('%', ''));
                }
                
                output.innerHTML = `
                    <p class="success">âœ… ØªØ³Øª Ù…ÙˆÙÙ‚!</p>
                    <h4>Ø¢Ù…Ø§Ø±:</h4>
                    <p>âœ… Ø³Ø§Ù„Ù…: ${totalHealthy.toLocaleString('fa-IR')}</p>
                    <p>âŒ Ù†Ø§Ø³Ø§Ù„Ù…: ${totalFailed.toLocaleString('fa-IR')}</p>
                    <p>ğŸ“Š Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª: ${successRate}%</p>
                    <p>ğŸ”Œ Ù¾Ø±ÙˆØªÚ©Ù„â€ŒÙ‡Ø§: ${Object.keys(report.protocols || {}).length}</p>
                `;
            } catch (error) {
                output.innerHTML = `<p class="error">âŒ Ø®Ø·Ø§: ${error.message}</p>`;
            }
        }

        // Auto-refresh simulation
        function simulateAutoRefresh() {
            loadCounter++;
            document.getElementById('loadCount').textContent = loadCounter;
            document.getElementById('lastLoad').textContent = new Date().toLocaleString('fa-IR');
        }

        // Simulate auto-refresh every 10 seconds (for demo)
        setInterval(simulateAutoRefresh, 10000);
        simulateAutoRefresh();
    </script>
</body>
</html>

