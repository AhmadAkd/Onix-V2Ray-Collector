<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>انتخاب لینک اشتراک V2Ray</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #666;
            font-size: 1.2em;
        }

        .nav-tabs {
            border: none;
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 30px;
        }

        .nav-tabs .nav-link {
            border: none;
            border-radius: 10px;
            color: #666;
            font-weight: 600;
            padding: 15px 30px;
            margin: 0 5px;
            transition: all 0.3s;
        }

        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            height: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .protocol-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .badge-vmess {
            background: #4CAF50;
            color: white;
        }

        .badge-vless {
            background: #2196F3;
            color: white;
        }

        .badge-trojan {
            background: #FF9800;
            color: white;
        }

        .badge-ss {
            background: #9C27B0;
            color: white;
        }

        .badge-ssr {
            background: #E91E63;
            color: white;
        }

        .btn-copy {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
        }

        .btn-copy:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-copy.copied {
            background: #4CAF50;
        }

        .search-box {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 1.1em;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .stats-badge {
            display: inline-block;
            padding: 5px 10px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.85em;
            margin: 5px;
        }

        .country-flag {
            font-size: 2em;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-rocket"></i> انتخاب لینک اشتراک V2Ray</h1>
            <p>کانفیگ‌های رایگان و تست شده - به‌روزرسانی خودکار هر 30 دقیقه</p>
            <div class="mt-3">
                <span class="badge bg-success fs-6 me-2">
                    <i class="fas fa-check-circle"></i> <span id="total-configs">0</span> کانفیگ سالم
                </span>
                <span class="badge bg-info fs-6">
                    <i class="fas fa-clock"></i> آخرین بروزرسانی: <span id="last-update">در حال بارگذاری...</span>
                </span>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#all-tab" type="button">
                    <i class="fas fa-globe"></i> همه کانفیگ‌ها
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#protocol-tab" type="button">
                    <i class="fas fa-network-wired"></i> بر اساس پروتکل
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#country-tab" type="button">
                    <i class="fas fa-flag"></i> بر اساس کشور
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- All Configs Tab -->
            <div class="tab-pane fade show active" id="all-tab">
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body text-center p-5">
                                <i class="fas fa-download fa-4x text-primary mb-4"></i>
                                <h3>همه کانفیگ‌های سالم</h3>
                                <p class="text-muted">شامل تمام پروتکل‌ها و کشورها</p>
                                <div class="my-4">
                                    <code class="bg-light p-3 rounded d-block" id="all-link">
                                        https://raw.githubusercontent.com/AhmadAkd/V2Ray_Collector/main/subscriptions/all_subscription.txt
                                    </code>
                                </div>
                                <button class="btn-copy" onclick="copyLink('all-link', this)">
                                    <i class="fas fa-copy"></i> کپی لینک
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Protocol Tab -->
            <div class="tab-pane fade" id="protocol-tab">
                <input type="text" class="search-box" placeholder="🔍 جستجو در پروتکل‌ها..."
                    onkeyup="filterCards('protocol-grid', this.value)">

                <div class="row g-4" id="protocol-grid">
                    <!-- VMess -->
                    <div class="col-lg-4 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <span class="protocol-badge badge-vmess">VMess</span>
                                <h5 class="card-title mt-2">🔵 VMess Protocol</h5>
                                <p class="card-text">پروتکل VMess با پشتیبانی کامل از TLS و WebSocket</p>
                                <div class="stats-badge">
                                    <i class="fas fa-server"></i> <span id="vmess-count">-</span> سرور
                                </div>
                                <div class="stats-badge">
                                    <i class="fas fa-tachometer-alt"></i> <span id="vmess-latency">-</span>
                                </div>
                                <button class="btn-copy mt-3" onclick="copyProtocolLink('vmess', this)">
                                    <i class="fas fa-copy"></i> کپی لینک VMess
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- VLESS -->
                    <div class="col-lg-4 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <span class="protocol-badge badge-vless">VLESS</span>
                                <h5 class="card-title mt-2">🟢 VLESS Protocol</h5>
                                <p class="card-text">پروتکل VLESS جدید با عملکرد بهینه و سرعت بالا</p>
                                <div class="stats-badge">
                                    <i class="fas fa-server"></i> <span id="vless-count">-</span> سرور
                                </div>
                                <div class="stats-badge">
                                    <i class="fas fa-tachometer-alt"></i> <span id="vless-latency">-</span>
                                </div>
                                <button class="btn-copy mt-3" onclick="copyProtocolLink('vless', this)">
                                    <i class="fas fa-copy"></i> کپی لینک VLESS
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Trojan -->
                    <div class="col-lg-4 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <span class="protocol-badge badge-trojan">Trojan</span>
                                <h5 class="card-title mt-2">🟡 Trojan Protocol</h5>
                                <p class="card-text">پروتکل Trojan با امنیت بالا و رمزنگاری قوی</p>
                                <div class="stats-badge">
                                    <i class="fas fa-server"></i> <span id="trojan-count">-</span> سرور
                                </div>
                                <div class="stats-badge">
                                    <i class="fas fa-tachometer-alt"></i> <span id="trojan-latency">-</span>
                                </div>
                                <button class="btn-copy mt-3" onclick="copyProtocolLink('trojan', this)">
                                    <i class="fas fa-copy"></i> کپی لینک Trojan
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Shadowsocks -->
                    <div class="col-lg-4 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <span class="protocol-badge badge-ss">Shadowsocks</span>
                                <h5 class="card-title mt-2">🟠 Shadowsocks</h5>
                                <p class="card-text">پروتکل Shadowsocks کلاسیک و قابل اعتماد</p>
                                <div class="stats-badge">
                                    <i class="fas fa-server"></i> <span id="ss-count">-</span> سرور
                                </div>
                                <div class="stats-badge">
                                    <i class="fas fa-tachometer-alt"></i> <span id="ss-latency">-</span>
                                </div>
                                <button class="btn-copy mt-3" onclick="copyProtocolLink('ss', this)">
                                    <i class="fas fa-copy"></i> کپی لینک Shadowsocks
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ShadowsocksR -->
                    <div class="col-lg-4 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <span class="protocol-badge badge-ssr">ShadowsocksR</span>
                                <h5 class="card-title mt-2">🟣 ShadowsocksR</h5>
                                <p class="card-text">پروتکل ShadowsocksR با قابلیت‌های پیشرفته</p>
                                <div class="stats-badge">
                                    <i class="fas fa-server"></i> <span id="ssr-count">-</span> سرور
                                </div>
                                <div class="stats-badge">
                                    <i class="fas fa-tachometer-alt"></i> <span id="ssr-latency">-</span>
                                </div>
                                <button class="btn-copy mt-3" onclick="copyProtocolLink('ssr', this)">
                                    <i class="fas fa-copy"></i> کپی لینک ShadowsocksR
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Country Tab -->
            <div class="tab-pane fade" id="country-tab">
                <input type="text" class="search-box" placeholder="🔍 جستجو در کشورها..."
                    onkeyup="filterCards('country-grid', this.value)">

                <div class="row g-4" id="country-grid">
                    <!-- Countries will be loaded dynamically -->
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-5">
            <div class="card">
                <div class="card-body">
                    <h5><i class="fas fa-info-circle"></i> راهنمای استفاده</h5>
                    <p class="mb-2">1️⃣ پروتکل یا کشور مورد نظر را انتخاب کنید</p>
                    <p class="mb-2">2️⃣ روی دکمه "کپی لینک" کلیک کنید</p>
                    <p class="mb-2">3️⃣ لینک را در کلاینت V2Ray خود وارد کنید</p>
                    <p class="text-muted mt-3">
                        <i class="fas fa-sync-alt"></i> به‌روزرسانی خودکار هر 30 دقیقه
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const BASE_URL = 'https://raw.githubusercontent.com/AhmadAkd/V2Ray_Collector/main/subscriptions';

        // Country list with flags
        const countries = [
            { code: 'US', name: 'آمریکا', flag: '🇺🇸' },
            { code: 'DE', name: 'آلمان', flag: '🇩🇪' },
            { code: 'NL', name: 'هلند', flag: '🇳🇱' },
            { code: 'CA', name: 'کانادا', flag: '🇨🇦' },
            { code: 'GB', name: 'انگلیس', flag: '🇬🇧' },
            { code: 'FR', name: 'فرانسه', flag: '🇫🇷' },
            { code: 'JP', name: 'ژاپن', flag: '🇯🇵' },
            { code: 'SG', name: 'سنگاپور', flag: '🇸🇬' },
            { code: 'TR', name: 'ترکیه', flag: '🇹🇷' },
            { code: 'IR', name: 'ایران', flag: '🇮🇷' },
            { code: 'SE', name: 'سوئد', flag: '🇸🇪' },
            { code: 'NO', name: 'نروژ', flag: '🇳🇴' },
            { code: 'FI', name: 'فنلاند', flag: '🇫🇮' },
            { code: 'PL', name: 'لهستان', flag: '🇵🇱' },
            { code: 'IT', name: 'ایتالیا', flag: '🇮🇹' },
            { code: 'ES', name: 'اسپانیا', flag: '🇪🇸' },
            { code: 'CH', name: 'سوئیس', flag: '🇨🇭' },
            { code: 'AU', name: 'استرالیا', flag: '🇦🇺' },
            { code: 'BR', name: 'برزیل', flag: '🇧🇷' },
            { code: 'IN', name: 'هند', flag: '🇮🇳' },
            { code: 'KR', name: 'کره جنوبی', flag: '🇰🇷' },
            { code: 'HK', name: 'هنگ کنگ', flag: '🇭🇰' },
            { code: 'TW', name: 'تایوان', flag: '🇹🇼' },
            { code: 'RU', name: 'روسیه', flag: '🇷🇺' },
            { code: 'UA', name: 'اوکراین', flag: '🇺🇦' }
        ];

        // Copy link function
        function copyLink(elementId, button) {
            const element = document.getElementById(elementId);
            const text = element.textContent.trim();

            navigator.clipboard.writeText(text).then(() => {
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> کپی شد!';
                button.classList.add('copied');

                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('خطا در کپی:', err);
                alert('خطا در کپی کردن لینک');
            });
        }

        // Copy protocol link
        function copyProtocolLink(protocol, button) {
            const link = `${BASE_URL}/${protocol}_subscription.txt`;

            navigator.clipboard.writeText(link).then(() => {
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> کپی شد!';
                button.classList.add('copied');

                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('خطا در کپی:', err);
                alert('خطا در کپی کردن لینک');
            });
        }

        // Copy country link
        function copyCountryLink(countryCode, button) {
            const link = `${BASE_URL}/by_country/${countryCode}.txt`;

            navigator.clipboard.writeText(link).then(() => {
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> کپی شد!';
                button.classList.add('copied');

                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('خطا در کپی:', err);
                alert('خطا در کپی کردن لینک');
            });
        }

        // Filter cards
        function filterCards(gridId, searchTerm) {
            const cards = document.querySelectorAll(`#${gridId} .card`);
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                if (text.includes(searchTerm.toLowerCase())) {
                    card.parentElement.style.display = 'block';
                } else {
                    card.parentElement.style.display = 'none';
                }
            });
        }

        // Load countries
        function loadCountries() {
            const countryGrid = document.getElementById('country-grid');
            countryGrid.innerHTML = '';

            countries.forEach(country => {
                const col = document.createElement('div');
                col.className = 'col-lg-3 col-md-4 col-sm-6';
                col.innerHTML = `
                    <div class="card">
                        <div class="card-body text-center">
                            <div class="country-flag">${country.flag}</div>
                            <h5 class="card-title">${country.name}</h5>
                            <p class="card-text text-muted">${country.code}</p>
                            <button class="btn-copy" onclick="copyCountryLink('${country.code}', this)">
                                <i class="fas fa-copy"></i> کپی لینک
                            </button>
                        </div>
                    </div>
                `;
                countryGrid.appendChild(col);
            });
        }

        // Load statistics from report
        async function loadStatistics() {
            try {
                const response = await fetch('latest_report.json');
                const report = await response.json();

                // Update total configs
                document.getElementById('total-configs').textContent =
                    (report.working_configs || 0).toLocaleString('fa-IR');

                // Update last update time
                document.getElementById('last-update').textContent = report.timestamp || 'نامشخص';

                // Update protocol counts
                if (report.protocols) {
                    Object.entries(report.protocols).forEach(([protocol, data]) => {
                        const countElement = document.getElementById(`${protocol}-count`);
                        const latencyElement = document.getElementById(`${protocol}-latency`);

                        if (countElement) {
                            countElement.textContent = (data.count || 0).toLocaleString('fa-IR');
                        }
                        if (latencyElement) {
                            latencyElement.textContent = data.avg_latency || 'N/A';
                        }
                    });
                }
            } catch (error) {
                console.error('خطا در بارگذاری آمار:', error);
                document.getElementById('total-configs').textContent = 'N/A';
                document.getElementById('last-update').textContent = 'خطا در بارگذاری';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            loadCountries();
            loadStatistics();

            // Reload stats every 5 minutes
            setInterval(loadStatistics, 5 * 60 * 1000);
        });
    </script>
</body>

</html>