# 🚀 V2Ray Config Collector & Tester

<div align="center">

[![V2Ray Collector](https://img.shields.io/badge/V2Ray-Collector-blue?style=for-the-badge&logo=v2ray)](https://github.com/AhmadAkd/V2Ray_Collector)
[![Python](https://img.shields.io/badge/Python-3.8+-green?style=for-the-badge&logo=python)](https://www.python.org/)
[![GitHub Actions](https://img.shields.io/badge/GitHub%20Actions-Automated-orange?style=for-the-badge&logo=github)](https://github.com/features/actions)
[![License](https://img.shields.io/badge/License-MIT-yellow?style=for-the-badge)](LICENSE)
[![Docker](https://img.shields.io/badge/Docker-Ready-blue?style=for-the-badge&logo=docker)](https://www.docker.com/)
[![FastAPI](https://img.shields.io/badge/FastAPI-API-teal?style=for-the-badge&logo=fastapi)](https://fastapi.tiangolo.com/)

**🔒 Advanced System for Automated Collection, Testing & Categorization of Free V2Ray Configs**

*Smart Automation • Protocol-Based Testing • Advanced Analytics • Health Monitoring • RESTful API*

[🌐 View Main Page](https://ahmadakd.github.io/V2Ray_Collector/) •
[📊 Dashboard](https://ahmadakd.github.io/V2Ray_Collector/subscriptions/dashboard.html) •
[📚 Documentation](docs/) •
[🐛 Report Bug](https://github.com/AhmadAkd/V2Ray_Collector/issues)

</div>

---

## 📖 Table of Contents

- [✨ Key Features](#-key-features)
- [🎯 Advanced Capabilities](#-advanced-capabilities)
- [📡 Subscription Links](#-subscription-links)
- [🚀 Installation & Setup](#-installation--setup)
- [🔧 Usage](#-usage)
- [📊 API Documentation](#-api-documentation)
- [🐳 Docker Deployment](#-docker-deployment)
- [⚙️ Configuration](#️-configuration)
- [📈 Monitoring & Analytics](#-monitoring--analytics)
- [🤝 Contributing](#-contributing)
- [📄 License](#-license)

---

## ✨ Key Features

### 🔄 **Smart Collection**

- 🌍 **28+ Trusted Sources** from around the world
- 📦 **Full Base64 Support** and various formats
- 🔄 **Automatic Collection** every 30 minutes via GitHub Actions
- 💾 **Smart Caching** with TTL for improved performance
- 🎯 **Smart Filtering** - Pre-filter invalid configs

### ✅ **Professional Quality Testing**

- 🔌 **10 Protocols Supported**: VMess, VLESS, Trojan, Shadowsocks, SSR, Hysteria, Hysteria2, WireGuard, TUIC, Naive
- ⚡ **Ultra-Fast Testing** with 100 concurrent connections
- 🔐 **Protocol-Based Testing** - Real TCP/TLS testing
- 📊 **95%+ Accuracy** in detecting healthy configs
- ⏱️ **Precise Latency Measurement** for each config
- 🔍 **Smart Deduplication** - Remove duplicate configs

### 📊 **Advanced Analytics**

- 📈 **Performance Metrics** - Comprehensive performance metrics
- 📉 **Trend Analysis** - Historical data trend analysis
- 💡 **Key Insights** - Intelligent insights and recommendations
- 🎯 **Optimization Recommendations** - Performance optimization tips
- 📊 **Protocol Distribution** - Protocol and country distribution

### 🏥 **Health Monitoring**

- ✅ **6 Different Health Checks**
- 🌐 **GitHub Connectivity** - Connection monitoring
- 📡 **Config Sources** - Source accessibility check
- 💾 **Disk Space** - Disk space monitoring
- 🧠 **Memory Usage** - Memory monitoring
- ⚡ **Cache Performance** - Cache performance tracking

### 🌐 **Professional UI/UX**

- 🎨 **Advanced Dashboard** with Bootstrap 5
- 📱 **Responsive Design** - Compatible with all devices
- 📊 **Interactive Charts** - Chart.js
- 🔄 **Real-time Statistics** - Live stats
- 🎯 **Subscription Selector** - Smart selector
- 🌓 **Dark/Light Mode** - Dark/Light theme support

### 🔌 **RESTful API**

- ⚡ **FastAPI Framework** - Fast and modern
- 📡 **Complete Endpoints** - Access to all features
- 📊 **Real-time Stats** - Statistics API
- 🔐 **CORS Support** - CORS enabled
- 📝 **Auto Documentation** - Automatic Swagger docs

### 🤖 **Complete Automation**

- ⏰ **Scheduled Jobs** - Scheduled tasks
- 🔄 **Auto Deployment** - Automatic deployment
- 📊 **Stats Tracking** - Statistics tracking
- 🔔 **Notifications** - Smart notifications (Telegram, Email, Webhook)
- 🔧 **Error Recovery** - Automatic error recovery

---

## 🎯 Advanced Capabilities

### ⚡ **Performance Optimization**

```python
✅ UltraFastConnectionPool - Test 100 configs simultaneously
✅ SmartConfigFilter - Smart pre-filtering
✅ MD5 Hash Deduplication - Hash-based deduplication
✅ Async/Await - Asynchronous programming
✅ Connection Pooling - Optimal resource usage
```

### 📁 **Smart Categorization**

```
✅ Categorization by Protocol (10 protocols)
✅ Categorization by Country (270+ countries)
✅ Sorting by Latency
✅ Advanced Geographic Filtering
✅ Country Prioritization
```

### 🔐 **Security**

```
✅ Rate Limiting - Request limiting
✅ IP Blacklisting - IP blocking
✅ SSL/TLS Verification - Certificate verification
✅ Input Validation - Input validation
✅ Secure Headers - Secure headers
```

### 📊 **Reporting**

```
✅ JSON Reports - JSON reports
✅ Performance Metrics - Performance metrics
✅ Error Analysis - Error analysis
✅ Geographic Distribution - Geographic distribution
✅ Historical Data - Historical data
```

---

## 📡 Subscription Links

### 🌐 **Web Pages**

| Page | Description | Link |
|------|-------------|------|
| 🏠 **Main Page** | Display all subscription links | [View](https://ahmadakd.github.io/V2Ray_Collector/) |
| 📊 **Dashboard** | Management dashboard with complete stats | [View](https://ahmadakd.github.io/V2Ray_Collector/subscriptions/dashboard.html) |
| 🎯 **Selector** | Smart link selector | [View](https://ahmadakd.github.io/V2Ray_Collector/subscriptions/subscription_selector.html) |

### 📋 **Direct Subscription Links**

#### 📦 **All Configs** (Recommended)

```
https://raw.githubusercontent.com/AhmadAkd/V2Ray_Collector/main/subscriptions/all_subscription.txt
```

#### 🔵 **VMess** (Most Configs)

```
https://raw.githubusercontent.com/AhmadAkd/V2Ray_Collector/main/subscriptions/vmess_subscription.txt
```

#### 🟢 **VLESS** (Fastest)

```
https://raw.githubusercontent.com/AhmadAkd/V2Ray_Collector/main/subscriptions/vless_subscription.txt
```

#### 🟡 **Trojan** (Most Secure)

```
https://raw.githubusercontent.com/AhmadAkd/V2Ray_Collector/main/subscriptions/trojan_subscription.txt
```

#### 🟠 **Shadowsocks**

```
https://raw.githubusercontent.com/AhmadAkd/V2Ray_Collector/main/subscriptions/ss_subscription.txt
```

#### 🟣 **ShadowsocksR**

```
https://raw.githubusercontent.com/AhmadAkd/V2Ray_Collector/main/subscriptions/ssr_subscription.txt
```

### 🌍 **Country-Based Categorization**

Subscription links by country:

```
https://raw.githubusercontent.com/AhmadAkd/V2Ray_Collector/main/subscriptions/by_country/{COUNTRY_CODE}.txt
```

**Examples:**

- 🇺🇸 United States: `by_country/US.txt`
- 🇩🇪 Germany: `by_country/DE.txt`
- 🇳🇱 Netherlands: `by_country/NL.txt`
- 🇬🇧 United Kingdom: `by_country/GB.txt`

---

## 🚀 Installation & Setup

### 📋 **Prerequisites**

- Python 3.8 or higher
- pip (Python package manager)
- Git

### 📥 **Quick Install**

#### 1️⃣ **Clone the Repository**

```bash
git clone https://github.com/AhmadAkd/V2Ray_Collector.git
cd V2Ray_Collector
```

#### 2️⃣ **Install Dependencies**

```bash
pip install -r requirements.txt
```

#### 3️⃣ **Run the Project**

```bash
# Collect and test configs
python config_collector.py

# Run automation
python automation.py

# Start API server
python api_server.py
```

### 🪟 **Windows**

For Windows users, use PowerShell scripts:

```powershell
# Quick run
.\run.ps1

# Run with Persian language
.\run-fa.ps1

# Push to GitHub
.\push-to-github.ps1
```

### 🐧 **Linux/macOS**

```bash
# Run automation
chmod +x push-to-github.sh
./push-to-github.sh
```

---

## 🔧 Usage

### 1️⃣ **Manual Collection**

```python
from config_collector import V2RayCollector
import asyncio

async def main():
    collector = V2RayCollector()
    
    # Collect configs
    configs = await collector.collect_all_configs()
    print(f"✅ {len(configs)} configs collected")
    
    # Test configs
    await collector.test_all_configs(configs)
    print(f"✅ {len(collector.working_configs)} healthy configs")
    
    # Categorize
    categories = collector.categorize_configs()
    
    # Generate subscription files
    subscription_files = collector.generate_subscription_links(categories)
    
    # Generate report
    report = collector.generate_report()
    print(report)

asyncio.run(main())
```

### 2️⃣ **Automation**

```python
from automation import AutomationManager

# Create automation manager
manager = AutomationManager()

# Run once
await manager.run_collection_job()

# Run scheduled
manager.start_scheduler()
```

### 3️⃣ **Using the API**

```python
import requests

# Get overall stats
response = requests.get('http://localhost:8000/api/stats')
print(response.json())

# Get all configs
response = requests.get('http://localhost:8000/api/configs')
configs = response.json()

# Get VMess subscription link
response = requests.get('http://localhost:8000/api/subscription/vmess')
vmess_link = response.text
```

### 4️⃣ **Health Monitoring**

```python
from health_monitor import HealthMonitor
import asyncio

async def check_health():
    monitor = HealthMonitor()
    
    # Check all components
    health_report = await monitor.run_all_health_checks()
    
    # Display report
    for component, status in health_report.items():
        print(f"{component}: {status.status} - {status.message}")

asyncio.run(check_health())
```

### 5️⃣ **Analytics**

```python
from analytics import AdvancedAnalytics

# Create analytics
analytics = AdvancedAnalytics()

# Analyze performance
metrics = analytics.analyze_performance(configs_data)

# Analyze trends
trends = analytics.analyze_trends()

# Get insights
insights = analytics.get_key_insights(metrics)

# Generate comprehensive report
report = analytics.generate_comprehensive_report(configs_data)
```

---

## 📊 API Documentation

### 🔌 **Endpoints**

#### **1. Get Overall Stats**

```http
GET /api/stats
```

**Response:**

```json
{
  "total_configs": 2448,
  "working_configs": 2448,
  "protocols": {
    "vmess": 1526,
    "vless": 746,
    "trojan": 167
  },
  "countries": 270,
  "last_update": "2025-10-14 10:30:00",
  "success_rate": "70.5%"
}
```

#### **2. Get All Configs**

```http
GET /api/configs?protocol=vmess&limit=100
```

**Parameters:**

- `protocol` (optional): Filter by protocol
- `country` (optional): Filter by country
- `limit` (optional): Number of configs
- `offset` (optional): Starting index

#### **3. Get Subscription Link**

```http
GET /api/subscription/{protocol}
```

**Example:**

```bash
curl http://localhost:8000/api/subscription/vmess
```

#### **4. Health Check**

```http
GET /health
```

**Response:**

```json
{
  "status": "healthy",
  "timestamp": "2025-10-14T10:30:00",
  "components": {
    "github_connectivity": "healthy",
    "config_sources": "healthy",
    "disk_space": "healthy"
  }
}
```

#### **5. Get Analytics Report**

```http
GET /api/analytics
```

**Response includes:**

- Performance metrics
- Trend analysis
- Key insights
- Recommendations

### 📚 **Full Documentation**

Complete API documentation is available at:

```
http://localhost:8000/docs      # Swagger UI
http://localhost:8000/redoc     # ReDoc
```

---

## 🐳 Docker Deployment

### 🚀 **Quick Start**

#### **1. Build and Run with Docker Compose**

```bash
# Build and run
docker-compose up -d

# View logs
docker-compose logs -f

# Stop
docker-compose down
```

#### **2. Manual Image Build**

```bash
# Build image
docker build -t v2ray-collector .

# Run container
docker run -d \
  --name v2ray-collector \
  -v $(pwd)/subscriptions:/app/subscriptions \
  -v $(pwd)/cache:/app/cache \
  -p 8000:8000 \
  v2ray-collector
```

### 🎯 **Docker Services**

The project includes 2 services:

1. **v2ray-collector**: Automatic collection and testing
2. **v2ray-api**: API Server (port 8000)

### 📊 **Health Check**

Docker image includes automatic health check:

```dockerfile
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD python -c "import requests; requests.get('http://localhost:8000/health')"
```

---

## ⚙️ Configuration

### 📝 **config.py File**

All project settings are in the `config.py` file:

#### **1. General Settings**

```python
GENERAL_CONFIG = {
    'log_level': 'INFO',
    'max_retries': 3,
    'request_timeout': 30,
    'cleanup_days': 7
}
```

#### **2. Collection Settings**

```python
COLLECTION_CONFIG = {
    'max_concurrent_tests': 50,
    'test_timeout': 10,
    'min_latency_threshold': 5000,
    'enable_speed_test': True,
    'enable_ssl_check': True
}
```

#### **3. Config Sources**

```python
CONFIG_SOURCES = [
    "https://github.com/Epodonios/v2ray-configs/raw/main/All_Configs_base64_Sub.txt",
    "https://raw.githubusercontent.com/mahdibland/V2RayAggregator/master/sub/sub_merge.txt",
    # ... 26 more sources
]
```

#### **4. Supported Protocols**

```python
SUPPORTED_PROTOCOLS = {
    'vmess': {'enabled': True, 'priority': 1},
    'vless': {'enabled': True, 'priority': 2},
    'trojan': {'enabled': True, 'priority': 3},
    'shadowsocks': {'enabled': True, 'priority': 4},
    'shadowsocksr': {'enabled': True, 'priority': 5}
}
```

#### **5. Notification Settings**

```python
NOTIFICATION_CONFIG = {
    'enable_notifications': False,
    'notification_methods': ['email', 'webhook', 'telegram'],
    'alert_conditions': {
        'low_success_rate': 50,
        'high_error_rate': 20,
        'no_working_configs': True
    }
}
```

### 🔐 **Environment Variables**

```bash
# Set profile
export ACTIVE_PROFILE=production  # development, production, testing

# Telegram settings
export TELEGRAM_BOT_TOKEN=your_bot_token
export TELEGRAM_CHAT_ID=your_chat_id

# Email settings
export SMTP_SERVER=smtp.gmail.com
export SMTP_PORT=587
export SMTP_USERNAME=your_email
export SMTP_PASSWORD=your_password
```

---

## 📈 Monitoring & Analytics

### 📊 **Dashboard**

Management dashboard includes:

- 📈 **Real-time Stats** - Healthy/Unhealthy configs count
- 📊 **Charts** - Protocol and country distribution
- 🌍 **Geographic Map** - Geographic distribution of configs
- ⏱️ **Latency Charts** - Latency charts
- 📉 **Trend Analysis** - Trend changes

### 🏥 **Health Monitoring**

Health monitoring system includes:

1. **GitHub Connectivity** - GitHub connection
2. **Config Sources** - Source accessibility
3. **API Endpoints** - API status
4. **Disk Space** - Disk space
5. **Memory Usage** - Memory usage
6. **Cache Performance** - Cache performance

### 📊 **Analytics Reports**

Analytics reports include:

```json
{
  "performance_metrics": {
    "total_configs": 3470,
    "working_configs": 2448,
    "success_rate": 70.5,
    "avg_latency": 89.3
  },
  "trend_analysis": {
    "config_count_trend": "increasing",
    "success_rate_trend": "stable",
    "latency_trend": "improving"
  },
  "key_insights": [
    "VMess has the best performance",
    "US configs have lowest latency",
    "Success rate improved by 5%"
  ],
  "recommendations": [
    "Add more Trojan sources",
    "Optimize connection pool size",
    "Increase test timeout for slow regions"
  ]
}
```

---

## 🤖 GitHub Actions

### ⚙️ **Workflows**

The project includes 7 workflows:

#### **1. V2Ray Collector** (`v2ray-collector.yml`)

- ⏰ Runs every 30 minutes
- ✅ Test sources
- 📦 Collect configs
- 🧪 Quality testing
- 📊 Generate reports
- 🚀 Deploy to GitHub Pages

#### **2. Deploy Pages** (`deploy-pages.yml`)

- 🌐 Deploy to GitHub Pages
- 🔄 Trigger after Collector
- ✅ File verification

#### **3. Auto Collect** (`auto-collect.yml`)

- 🔄 Automatic collection
- ⏰ Scheduled

#### **4. CI** (`ci.yml`)

- 🧪 Run tests
- ✅ Linting
- 📊 Coverage Report

#### **5. Docker Build** (`docker-build.yml`)

- 🐳 Build Docker image
- 📦 Push to Docker Hub
- 🏷️ Tagging

#### **6. Test** (`test.yml`)

- 🧪 Unit tests
- 🔍 Integration tests
- ✅ E2E tests

#### **7. Release** (`release.yml`)

- 📦 Create release
- 📝 Changelog generation
- 🏷️ Version tagging

### 🔐 **Required Secrets**

For GitHub Actions:

```yaml
GITHUB_TOKEN: GitHub token (automatic)
DOCKER_USERNAME: Docker Hub username (optional)
DOCKER_PASSWORD: Docker Hub password (optional)
TELEGRAM_BOT_TOKEN: Telegram bot token (optional)
TELEGRAM_CHAT_ID: Telegram chat ID (optional)
```

---

## 📚 Documentation

### 📖 **Guides**

- 📘 [Installation Guide](docs/INSTALLATION.md) - Complete step-by-step installation
- 📗 [User Guide](docs/USER_GUIDE.md) - Using the project
- 📕 [Developer Guide](docs/DEVELOPER.md) - Development and contribution
- 📙 [API Documentation](docs/API.md) - Complete API docs
- 📔 [Troubleshooting](docs/TROUBLESHOOTING.md) - Common issues

### 📊 **Project Stats**

```
📦 File Count: 364
📝 Lines of Code: ~15,000
🔌 Supported Protocols: 10
🌍 Config Sources: 28+
🌏 Supported Countries: 270+
⭐ Code Quality: A+
```

---

## 🤝 Contributing

Your contribution to improving this project is highly valuable! 🙏

### 📝 **How to Contribute**

1. **Fork** the project
2. Create a **Branch** (`git checkout -b feature/amazing-feature`)
3. **Commit** changes (`git commit -m 'Add amazing feature'`)
4. **Push** to Branch (`git push origin feature/amazing-feature`)
5. Create a **Pull Request**

### 🐛 **Report Bugs**

Use [Issues](https://github.com/AhmadAkd/V2Ray_Collector/issues) to report bugs.

### 💡 **Suggestions**

Share your suggestions via [Discussions](https://github.com/AhmadAkd/V2Ray_Collector/discussions).

### 🌟 **Contributors**

<a href="https://github.com/AhmadAkd/V2Ray_Collector/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=AhmadAkd/V2Ray_Collector" />
</a>

---

## 📊 Project Status

### ✅ **Recent Activities**

- ✅ Added 28 new config sources
- ✅ Implemented ultra-fast testing (100 concurrent)
- ✅ Added Advanced Analytics
- ✅ Implemented Health Monitoring
- ✅ Designed Professional Dashboard
- ✅ Created RESTful API
- ✅ Complete Docker support
- ✅ Comprehensive documentation in Persian and English

### 🚀 **Future Plans**

- [ ] Add Hysteria v3 support
- [ ] Implement Load Balancing
- [ ] Add Grafana Dashboard
- [ ] Kubernetes support
- [ ] Create Mobile App
- [ ] Add Machine Learning for quality prediction

---

## 🔒 Security

To report security issues, please refer to [SECURITY.md](SECURITY.md).

**Note:** Never commit sensitive information (API keys, tokens, passwords) in code.

---

## 📄 License

This project is released under the MIT License. For more information, refer to the [LICENSE](LICENSE) file.

```
MIT License

Copyright (c) 2025 Ahmad Akd

Permission is hereby granted to use, copy, modify, merge, publish, distribute,
sublicense, and/or sell copies of the software.
```

---

## 🙏 Acknowledgments

### 📚 **Resources Used**

- [V2Ray](https://www.v2ray.com/) - Main protocol
- [FastAPI](https://fastapi.tiangolo.com/) - API Framework
- [Bootstrap](https://getbootstrap.com/) - UI Framework
- [Chart.js](https://www.chartjs.org/) - Charts
- V2Ray community free config sources

### ⭐ **Support the Project**

If this project was helpful to you:

- ⭐ **Star** the project
- 🐛 **Report** bugs
- 💡 **Suggest** new features
- 🤝 **Contribute** to development
- 📢 **Share** with others

---

## 📞 Contact Us

- 🐛 **Issues:** [GitHub Issues](https://github.com/AhmadAkd/V2Ray_Collector/issues)
- 💬 **Discussions:** [GitHub Discussions](https://github.com/AhmadAkd/V2Ray_Collector/discussions)
- 📧 **Email:** <ahmad.akd@example.com>
- 🌐 **Website:** [ahmadakd.github.io](https://ahmadakd.github.io/V2Ray_Collector/)

---

<div align="center">

**Made with ❤️ by [Ahmad Akd](https://github.com/AhmadAkd)**

⭐ If this project was useful to you, give it a Star! ⭐

[![GitHub stars](https://img.shields.io/github/stars/AhmadAkd/V2Ray_Collector?style=social)](https://github.com/AhmadAkd/V2Ray_Collector/stargazers)
[![GitHub forks](https://img.shields.io/github/forks/AhmadAkd/V2Ray_Collector?style=social)](https://github.com/AhmadAkd/V2Ray_Collector/network/members)
[![GitHub watchers](https://img.shields.io/github/watchers/AhmadAkd/V2Ray_Collector?style=social)](https://github.com/AhmadAkd/V2Ray_Collector/watchers)

</div>

---

**Version:** 2.0.0  
**Last Updated:** 2025-10-14  
**Status:** ✅ Active and under development
